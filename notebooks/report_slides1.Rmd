---
title: "A step towards a robust multi-modal risk prediction model of PTSD"
subtitle: "Incorporating genetic score with other pre-trauma risk factors"
author:
  - Meeting venue
  - Harvard/McLean
date: May 2020
output:
  ioslides_presentation:
    transition: slower
---

<!-- The following removes page numbers on slides. -->
<style type="text/css">
slides > slide:not(.nobackground):after {
  content: '';
}
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE,  message=FALSE)
```



# Background and Motivation

## Why PTSD biomarker?
- PTSD is a debilitating and prevalent mental disorder affecting military as well as civilian population. 
- Exposure to trauma is a necessary but not sufficient condition/criteria for PTSD onset and diagnosis. In fact, only about 10% of people with traumatic experience develops a full-fledged PTSD.
- A complex multifactorial confluence of biological and environmental factors is thought to determine susceptibility to PTSD.
- Understanding how these risk and resilience factors play out to determine PTSD outcomes is crucial for planning preventative strategies and for developing early diagnostic tools and therapeutic interventions.


## Two main approaches / road maps

- Previously we started with 1M heterogenous features and selected down to a 17 multi-omic marker panel [CITE]. 
- But this purely data-driven approach is limited by lack of sufficient sample size for a robust predictive model. 
- An alternative (and complementary) approach is to start from a few (or single) markers and incrementally incorporate additional markers guided by prior knowledge as well as available data.
- We started from a genetic score and incorporate additional predictors incrementally.

## Why start with genetic score?

- A substantial contribution of genetics to PTSD risk has been confirmed from early twin/family studies 
- Unlike other molecular risk factors (such as other omics profiles) it does not have tissue specific patterns (very relevant for psychiatric biomarker). 
- Third, it is a stable marker and technologies with reliable analytical validity are available to measure it accurately and inexpensively. 
- Genetic data for most people will be available with no additional measurement cost and inconvenience 
- External large-scale generic studies can be leveraged to train our predictive models. We can even incorporate GWAS results from genetically correlated disorders and traits.
- Can be assessed before trauma exposure


## Why incorporate additional risk factors?

- Currently available PTSD genetic studies are still very under-powered, genetic predictors still have low performance. 
- Also, since PTSD is only moderately heritable (h^2â‰ˆ30%-70% depending on gender), a genetic score by itself is inherently limited.
- Even if the need for a multi-input model is clear, the risk factors that should be included and how best to combine them are less clear. 

## Choosing other predictors

Three main criteria:
- literature evidence for a relatively large effect
- pre-trauma risk factor like genetics
- can be measured easily and accurately

Accordingly, three predictors are studied in the first stage
1. Polygenic risk (PRS)
2. Childhood adversity (CA)
3. Educational attainment (EA)




```{r}
.libPaths( c( "/opt/R/3.6.2/lib/R/library" , .libPaths() ) )
```

```{r}
library(tidyverse)
```


```{r message=FALSE, warning=FALSE}
# loading datasets

# SysBio pheno data
t1 <- read_delim("/data/humgen/burook/SysBio_analysis/table_pred", col_names = TRUE, delim = " ")
sb_pheno1 <- read_delim("/data/humgen/burook/data_raw/sb/PTSD_clinical.txt", col_names = TRUE, delim = "\t") %>%
  mutate(ID=as.character(ID)) %>% 
  inner_join(t1, by=c("ID"="Sample"))
  
# Ft. Campbell pheno data
t1 <- read_delim("/data/humgen/burook/FC_analysis/table_pred", col_names = TRUE, delim = " ") 
fc_pheno1 <- read_delim("/data/humgen/burook/data_raw/fc/clinical/FC_data_for_PGM.txt", col_names = TRUE, delim = "\t") %>% 
  mutate(ID=as.character(ID)) %>% 
  inner_join(t1, by=c("ID"="Sample")) 

# GTP pheno data
t1 <- read_delim("/data/humgen/burook/GTP_analysis/table_pred", col_names = TRUE, delim = " ") 
gtp_pheno1 <- read_delim("/data/humgen/burook/GTP_analysis/GTP_pheno1.txt", col_names = TRUE, delim = "\t") %>% 
  inner_join(t1, by=c("IID"="Sample")) 

# AURORA data
t1 <- read_delim("/data/humgen/burook/AURORA/table_pred", col_names = TRUE, delim = " ")
aur_pheno1 <- read_delim("/data/humgen/burook/AURORA/aur_pheno1.txt", col_names = TRUE, delim = "\t") %>% 
  mutate(IID=as.character(IID)) %>% 
  inner_join(t1, by=c("IID"="Sample")) 
```



## Cohorts Description 
```{r}
muSd <- function(x, d) paste(round(mean(x,na.rm = T),d), " (", round(sd(x,na.rm = T),d), ")", sep = "")
```

| Dataset | SysBio | Ft. Campbell | GTP | AURORA | 
|---------------|---------------|---------------|---------------|---------------|
| Use      | Training and Validation | Testing/ Replication | Testing/ Replication | Testing/ Replication |
| n      | `r nrow(sb_pheno1)` | `r nrow(fc_pheno1)` |  `r nrow(gtp_pheno1)` | `r nrow(aur_pheno1)`  |
| Population      | Veterans from Marines, Navy, Army and the Air Force | Active-duty Army personnel | Civilian recruited from primary care waiting room | Civilian recruited at emergency room |
| Diagnosis Score      | CAPS | PCL | PTSS | PCL |
| Age: mean (sd) | `r muSd(sb_pheno1$DemoAge,2)` | `r muSd(fc_pheno1$T3_AGE,2)` | `r muSd(gtp_pheno1$age,2)` | `r muSd(aur_pheno1$ED_Age,2)` |
| BMI: mean (sd) | `r muSd(sb_pheno1$BMI,2)` | `r muSd(fc_pheno1$BMI,2)` |  | `r muSd(aur_pheno1$BMI,2)` |




## Cohorts Description | differ in ancestry and gender composition, case prevalence

| SysBio   | Ft. Campbell | GTP    | AURORA |
|---------------|---------------|---------------|---------------|
|<img width=180/>|<img width=180/>|<img width=180/>|<img width=180/>|

```{r fig.show = "hold", out.width = "25%"}

# Race/ethnicity

sb_pheno1 %>% 
  group_by(predtree) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=predtree )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("SysBio") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title

fc_pheno1 %>% 
  group_by(predtree) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=predtree )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("Ft. Campbell") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title

gtp_pheno1 %>% 
  group_by(predtree) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=predtree )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("GTP") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title

aur_pheno1 %>% 
  group_by(predtree) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=predtree )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("AURORA") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title


# Gender

sb_pheno1 %>% 
  mutate(DemoGend=factor(DemoGend) %>% fct_recode(male="1",female="2") %>% fct_relevel("male","female")) %>% 
  group_by(DemoGend) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=DemoGend )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("SysBio") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title

fc_pheno1 %>% 
  mutate(GENDER=as.factor(GENDER) %>% fct_recode(male="Male",female="Female") %>% fct_relevel("male","female")) %>% 
  group_by(GENDER) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=GENDER )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("Ft. Campbell") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title


gtp_pheno1 %>% 
  mutate(sex=as.factor(sex)%>% fct_recode(male="0",female="1",NULL="8584") %>% fct_relevel("male","female")) %>% 
  group_by(sex) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=sex )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("GTP") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title

aur_pheno1 %>% 
  mutate(gend=as.factor(gend) %>% fct_recode(male="1",female="2") %>% fct_relevel("male","female")) %>% 
  group_by(gend) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=gend )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("AURORA") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title

# PTSD status

sb_pheno1 %>% 
  mutate(PTSD_status=as.factor(PTSD_status)) %>% 
  group_by(PTSD_status) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=PTSD_status )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("SysBio") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title

fc_pheno1 %>% 
  mutate(PTSD_status=as.factor(PTSD_status)) %>% 
  group_by(PTSD_status) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=PTSD_status )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("Ft. Campbell") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title

gtp_pheno1 %>% 
  mutate(PTSD_diagnosis=as.factor(PTSD_diagnosis)) %>% 
  group_by(PTSD_diagnosis) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=PTSD_diagnosis )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("GTP") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title

aur_pheno1 %>% 
  mutate(M3_PCL5=as.factor(M3_PCL5)) %>% 
  group_by(M3_PCL5) %>%
  summarise(n=n()) %>%
  ggplot(aes(x="", y=n, fill=M3_PCL5 )) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  ggtitle("AURORA") + 
  theme_void() +  # remove background, grid, numeric labels
  theme(plot.title = element_text(hjust=0.5))  # center the title

```



# Marginal effects of individual predictors


# Building composite risk score of the three

## Training performance

```{r}
load(file = "/data/humgen/burook/ptsd_multimodal_prediction_stage1/model1.RData")
knitr::kable(AUC3, caption = "Table with kable")
```

## Training performance

```{r, results='asis'}
library(xtable)
options(xtable.floating = FALSE)
options(xtable.timestamp = "")

print(xtable(AUC3, digits = 3), type = "html")

df <- data.frame(A = c(1.00123, 33.1, 6),
                 B = c(111111, 3333333, 3123.233))
## The following code gives the error
## formal argument "digits" matched by multiple actual arguments
## print(xtable(df, display = c("s","e","e")),
##       format.args = list(digits = 3, big.mark = " ", decimal.mark = ","))
## specify digits as argument to xtable instead
print(xtable(df), type = "html")
```


 
# Summary and future work



